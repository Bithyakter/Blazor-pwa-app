@page "/facilities"
@inject IFacilityService FacilityService
@inject IJSRuntime js
@inject NavigationManager NavigationManager

<PageTitle>Facilities</PageTitle>

<h3>Facilities</h3>

<button class="btn btn-primary" @onclick="CreateNewFacility">Create New Facility</button>

<table class="table">

   <thead>
      <tr>
         <th>District</th>
         <th>Facility</th>
         <th>HMIS Code</th>
         <th>Latitude</th>
         <th>Longitude</th>
         <th>Private Facility</th>
         <th></th>
      </tr>
   </thead>

   <tbody>
      @foreach (var facility in FacilityService.Facilities)
      {
         <tr>
            <td>@facility.District.DistrictName</td>
            <td>@facility.FacilityName</td>
            <td>@facility.HMISCode</td>
            <td>@facility.Latitude</td>
            <td>@facility.Longitude</td>
            <td>
               <span>@(facility.IsPrivateFacility ? "Yes" : "No")</span>
            </td>
            <td>
               <button class="btn btn-primary" @onclick="(() => ShowFacility(facility.Oid))"><i class="oi oi-pencil"></i></button>
               <button type="button" class="btn btn-danger mx-2" @onclick="(() => ConfirmDelete(facility.Oid, facility.FacilityName))"><i class="oi oi-delete"></i></button>
            </td>
         </tr>
      }
   </tbody>

</table>

@code {
   protected override async Task OnInitializedAsync()
   {
      await FacilityService.GetFacilities();
   }

   void ShowFacility(int id)
   {
      NavigationManager.NavigateTo($"createfacility/{id}");
   }

   void CreateNewFacility()
   {
      NavigationManager.NavigateTo("/createfacility");
   }

   //async Task DeleteFacility(int facilityId)
   //{
   //   await FacilityService.DeleteFacility(facilityId);
   //   await FacilityService.GetFacilities();
   //}

   async Task ConfirmDelete(int id, string facility)
   {
      if (await js.InvokeAsync<bool>("confirm", $"Do you want to delete {facility}'s ({id}) Record?"))
      {
         await FacilityService.DeleteFacility(id);
         await FacilityService.GetFacilities();
      }
   }
}